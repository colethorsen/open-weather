/*!

Name: Open Weather
Dependencies: jQuery, OpenWeatherMap API
Author: Michael Lynch
Author URL: http://michaelynch.com
Date Created: August 28, 2013
Date Modified: Octover 7, 2014
Modified by: Cole Thorsen (impulsestudios.ca)
Licensed under the MIT license

*/

(function(f){f.fn.openWeather=function(e){if(!this.length)return this;var l=f(this);this.settings={};var a=this.settings=f.extend({},{customIcons:null,units:"c",city:null,lat:null,lng:null,key:null,lang:"en",type:"weather",weatherTarget:null,weatherTemplate:null,forecastDays:0,forecastTarget:null,forecastTemplate:null,success:function(){},error:function(b){}},e);e="http://api.openweathermap.org/data/2.5/%type%?lang="+a.lang;null!==a.city?e+="&q="+a.city.replace(" ",""):null!==a.lat&&null!==a.lng&&
(e+="&lat="+a.lat+"&lon="+a.lng);null!==a.key&&(e+="&APPID="+a.key);var h=function(b){var a=new Date(1E3*b);b=a.getHours();var c="AM";12<=b&&(b-=12,c="PM");0===b&&(b=12);a=a.getMinutes();a=a.toString();2>a.length&&(a=0+a);return b+":"+a+" "+c},g=function(b){return b="f"==a.units?Math.round(1.8*(b-273.15)+32):Math.round(b-273.15)},k=function(b){if(null!==a.iconTarget&&null!==b.icon){var d;if(null!==a.customIcons){d=b.icon;var c,e;e=-1!=d.indexOf("d")?"day":"night";switch(d.substring(0,2)){case "01":c=
"clear";break;case "02":c="few";break;case "03":case "04":c="clouds";break;case "09":case "10":c="rain";break;case "11":c="storm";break;case "13":c="snow";break;case "50":c="mist"}d=a.customIcons+e+"/"+c+".png"}else d="http://openweathermap.org/img/w/"+b.icon+".png";return'<img class="weather_icon" src="'+d+'" alt="'+b.main+'">'}};"forecast"!=a.type&&f.ajax({type:"GET",url:e.replace("%type%","weather"),dataType:"jsonp",success:function(b){var d=a.weatherTemplate;null===a.weatherTemplate?l.html(g(b.main.temp)+
("&deg"+a.units.toUpperCase())):(d=d.replace("{{temp}}",g(b.main.temp)).replace("{{tempMin}}",g(b.main.temp_min)).replace("{{tempMax}}",g(b.main.temp_max)).replace("{{description}}",b.weather[0].description).replace("{{icon}}",k(b.weather[0])).replace("{{location}}",b.name+", "+b.sys.country).replace("{{windSpeed}}",Math.round(b.wind.speed)+" Mph").replace("{{pressure}}",b.main.pressure+" hPa").replace("{{humidity}}",b.main.humidity+"%").replace("{{sunrise}}",h(b.sys.sunrise)).replace("{{sunset}}",
h(b.sys.sunset)).replace(/{{units}}/g,"&deg"+a.units.toUpperCase()),f(a.weatherTarget).html(d));a.success.call(this)},error:function(b,d,c){a.error.call(this,d)}});"weather"!=a.type&&0<a.forecastDays&&f.ajax({type:"GET",url:e.replace("%type%","forecast/daily"),dataType:"jsonp",success:function(b){for(i=0;i<a.forecastDays;i++){var d=a.forecastTemplate,c=b.list[i];console.log(c);d=d.replace("{{tempMin}}",g(c.temp.min)).replace("{{tempMax}}",g(c.temp.max)).replace("{{description}}",c.weather[0].description).replace("{{icon}}",
k(c.weather[0])).replace("{{pressure}}",c.pressure+" hPa").replace("{{humidity}}",c.humidity+"%").replace("{{day}}","Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ")[(new Date(1E3*c.dt)).getDay()]).replace(/{{units}}/g,"&deg"+a.units.toUpperCase());f(a.forecastTarget).append(d)}},error:function(b,d,c){a.error.call(this,d)}})}})(jQuery);