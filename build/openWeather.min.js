/*!

Name: Open Weather
Dependencies: jQuery, OpenWeatherMap API
Author: Michael Lynch
Author URL: http://michaelynch.com
Date Created: August 28, 2013
Date Modified: December 24, 2014
Modified by: Cole Thorsen (impulsestudios.ca)
Licensed under the MIT license

*/

(function(f){f.fn.openWeather=function(e){if(!this.length)return this;var l=f(this);this.settings={};var b=this.settings=f.extend({},{customIcons:null,units:"c",city:null,lat:null,lng:null,key:null,lang:"en",type:"weather",weatherTarget:null,weatherTemplate:null,forecastDays:0,forecastTarget:null,forecastTemplate:null,success:function(){},error:function(a){}},e);e="http://api.openweathermap.org/data/2.5/%type%?lang="+b.lang;null!==b.city?e+="&q="+b.city:null!==b.lat&&null!==b.lng&&(e+="&lat="+b.lat+
"&lon="+b.lng);null!==b.key&&(e+="&APPID="+b.key);var h=function(a){var b=new Date(1E3*a);a=b.getHours();var c="AM";12<=a&&(a-=12,c="PM");0===a&&(a=12);b=b.getMinutes();b=b.toString();2>b.length&&(b=0+b);return a+":"+b+" "+c},g=function(a){return a="f"==b.units?Math.round(1.8*(a-273.15)+32):Math.round(a-273.15)},k=function(a){if(null!==b.iconTarget&&null!==a.icon){var d;if(null!==b.customIcons){d=a.icon;var c,e;e=-1!=d.indexOf("d")?"day":"night";switch(d.substring(0,2)){case "01":c="clear";break;
case "02":c="few";break;case "03":case "04":c="clouds";break;case "09":case "10":c="rain";break;case "11":c="storm";break;case "13":c="snow";break;case "50":c="mist"}d=b.customIcons+e+"/"+c+".png"}else d="http://openweathermap.org/img/w/"+a.icon+".png";return'<img class="weather_icon" src="'+d+'" alt="'+a.main+'">'}};"forecast"!=b.type&&f.ajax({type:"GET",url:e.replace("%type%","weather"),dataType:"jsonp",success:function(a){var d=b.weatherTemplate;"undefined"!=typeof a.message?b.error.call(this,
a.message):null===b.weatherTemplate?l.html(g(a.main.temp)+("&deg"+b.units.toUpperCase())):(d=d.replace("{{temp}}",g(a.main.temp)).replace("{{tempMin}}",g(a.main.temp_min)).replace("{{tempMax}}",g(a.main.temp_max)).replace("{{description}}",a.weather[0].description).replace("{{icon}}",k(a.weather[0])).replace("{{location}}",a.name+", "+a.sys.country).replace("{{windSpeed}}",Math.round(a.wind.speed)+" Mph").replace("{{pressure}}",a.main.pressure+" hPa").replace("{{humidity}}",a.main.humidity+"%").replace("{{sunrise}}",
h(a.sys.sunrise)).replace("{{sunset}}",h(a.sys.sunset)).replace(/{{units}}/g,"&deg"+b.units.toUpperCase()),f(b.weatherTarget).html(d));b.success.call(this)},error:function(a,d,c){b.error.call(this,d)}});"weather"!=b.type&&0<b.forecastDays&&f.ajax({type:"GET",url:e.replace("%type%","forecast/daily"),dataType:"jsonp",success:function(a){if("undefined"==typeof a.message)b.error.call(this,a.message);else for(i=0;i<b.forecastDays;i++){var d=b.forecastTemplate,c=a.list[i],d=d.replace("{{tempMin}}",g(c.temp.min)).replace("{{tempMax}}",
g(c.temp.max)).replace("{{description}}",c.weather[0].description).replace("{{icon}}",k(c.weather[0])).replace("{{pressure}}",c.pressure+" hPa").replace("{{humidity}}",c.humidity+"%").replace("{{day}}","Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ")[(new Date(1E3*c.dt)).getDay()]).replace(/{{units}}/g,"&deg"+b.units.toUpperCase());f(b.forecastTarget).append(d)}},error:function(a,d,c){b.error.call(this,d)}})}})(jQuery);